services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:8080"   # HTTP API + Frontend + WebSocket Gateway (/ws)
    env_file:
      - .env
    volumes:
      # Persistent database storage
      - ./data:/app/.db
      # Persistent workspace for agent files
      - ./workspace:/app/stark-backend/workspace
      # Persistent journal for agent notes
      - ./journal:/app/stark-backend/journal
      # Soul directory (copied from soul_template on first startup)
      - ./soul:/app/stark-backend/soul
      # Persistent memory for agent memories
      - ./memory:/app/stark-backend/memory
      # Persistent notes
      - ./notes:/app/stark-backend/notes
      # Persistent modules runtime data (databases, user-uploaded modules)
      - ./stark-backend/modules:/app/stark-backend/modules
    restart: unless-stopped
