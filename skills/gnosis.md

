---
name: safe
description: "Safe{Wallet} (Gnosis Safe) multisig skill for StarkBot. Supports creating Safe wallets, retrieving Safe details, and preparing/signing/executing Safe transactions with automatic simulation and confirmation. Optimized for Base and EVM chains."
version: 1.5
author: Discord @deadisdeadd
---

# Safe{Wallet} / Gnosis Safe Multisig Skill

This skill enables StarkBot to interact with Safe{Wallet} (formerly Gnosis Safe) multisig contracts on EVM chains.  
It supports:

- Creating new Safe multisigs  
- Fetching information about an existing Safe  
- Preparing, proposing, signing, and executing Safe transactions  

The default chain is **Base (chainId 8453)** unless specified otherwise.

---

# 1. Natural Language Triggers (Required)

The bot must consistently understand the following categories of user requests.

---

## 1.1 Create a Safe → `create_safe`

Example trigger phrases:
- “Create a safe”
- “Deploy a safe multisig”
- “Create a safe with owners 0xA 0xB threshold 2”

Bot must:
- Extract or request: owners, threshold, chain  
- Validate addresses and threshold  
- Confirm parameters before deployment  
- Deploy via Safe factory  
- Return the created Safe address and transaction hash

---

## 1.2 Sign a Safe Transaction → `safe_tx`

Trigger phrases:
- “Sign a tx on a safe”
- “Approve a safe transaction”
- “Send X ETH from safe 0x… to 0x…”
- “Execute a transaction for this safe”

Bot must:
1. Request missing information (safe address, to, value, data)  
2. Fetch owners + threshold  
3. Validate signer ownership  
4. Simulate the transaction  
5. Display simulation result  
6. Request confirmation for transfers or state changes  
7. Propose + sign the Safe tx  
8. Execute if threshold is met  
9. Return the proposal hash and execution tx hash (if executed)

---

## 1.3 Create and Sign a Safe Transaction

Trigger phrases:
- “Create and sign a tx on a safe”
- “Propose and sign a safe transaction”

Handled using the same flow as signing a Safe transaction.

---

## 1.4 Get Safe Info → `get_safe_info`

Trigger phrases:
- “Get info on a safe”
- “Show safe owners”
- “What is the threshold?”
- “What’s the nonce of this safe?”

Bot must return:
- Owners  
- Threshold  
- Balance  
- Nonce  
- Pending transactions  
- Safe version  
- Modules/guard if present  

---

# 2. Tool Actions

---

## 2.1 `create_safe`

**Inputs**
- `owners`: array of addresses  
- `threshold`: integer  
- `chain_id` (optional, default 8453)

**Behavior**
- Validate inputs  
- Confirm with user  
- Deploy Safe via factory  
- Return Safe address, tx hash, explorer link  

**Example**
```json
{
  "action": "create_safe",
  "owners": ["0x111...", "0x222..."],
  "threshold": 1
}
```

---

## 2.2 `safe_tx` — Propose / Sign / Execute

**Inputs**
- `safe`: Safe address  
- `to`: recipient address  
- `value`: ETH amount  
- `data`: optional calldata  
- `chain_id`: optional

**Behavior**
1. Ask for any missing fields  
2. Fetch Safe state (owners, threshold, nonce)  
3. Validate caller ownership  
4. **Simulate** the transaction  
5. Show simulation results (success/revert, gas estimate)  
6. Ask for explicit confirmation  
7. Propose + sign  
8. Execute automatically if threshold reached  
9. Return all relevant hashes + explorer links  

**Example**
```json
{
  "action": "safe_tx",
  "safe": "0xSAFE...",
  "to": "0xRECIPIENT...",
  "value": "0.5",
  "data": "0x"
}
```

---

## 2.3 `get_safe_info`

**Inputs**
- `safe`: address  
- `chain_id`: optional  

**Returns**
- Owners  
- Threshold  
- Balance  
- Nonce  
- Pending transactions  
- Safe version  
- Modules  

**Example**
```json
{
  "action": "get_safe_info",
  "safe": "0x1234..."
}
```

---

# 3. Simulation Requirements (Mandatory)

Before proposing or signing a Safe transaction, the bot must:
- Build the transaction  
- Run a simulation  
- Display:
  - Success/failure  
  - Revert reason (if any)  
  - Gas estimate  
  - Asset transfer details  

User must confirm the action before proceeding.

---

# 4. Confirmation Rules

For any state-changing Safe operation, especially transfers, the bot must request confirmation:

> “This will send X ETH from your Safe. Type YES to continue.”

---

# 5. Error Handling

The bot must provide clear explanations for errors, including:
- User is not a Safe owner  
- Invalid address  
- Threshold not met  
- Simulation failure  
- Safe not found on chain  

Example:
- “Error: You are not an owner of this Safe, so you cannot sign transactions.”

---

# 6. Default Chain Behavior

If the user doesn’t specify a chain, the bot must assume:

**Base (chainId 8453)**

Other chains are supported when explicitly requested.

---

# 7. Reviewer Test Cases (Must Pass)

### Create Safe
- “Create a safe”
- “Create a safe with owners 0xA 0xB threshold 2”

### Sign Safe Transaction
- “Sign a tx on a safe”
- “Send 1 ETH from safe 0xSAFE to 0xRECIPIENT”

### Create and Sign Transaction
- “Create and sign a tx on a safe”

### Get Safe Info
- “Get info on safe 0xSAFE”
- “Who are the owners?”

---